<div view-com-tpl="table">
    <div class="container-fluid table-responsive" >
        <div view-com="toolbar"></div>
        <table class="table table-hover table-bordered">
            <thead >
            <tr>
            </tr>
          </thead>
          <tbody>
          </tbody>
        </table>
        <div view-com="paging"></div>
    </div>
</div>
<script>
sm.view.oncominit("table",function(el){
    var tbel=el.querySelector("table.table");
    this.toolbar.editbar.show=false;
    this.toolbar.setitems("right",[
        ['fa fa-trash'],
        ['fa fa-cut'],
        ['fa fa-copy'],
    ]);
    
    this.data({
         _tbel:tbel,
    }).method({
        tbdata:{
            _tbel:tbel,
            tbel:function(){return this._tbel;},
            write:function(datas){
                var tableel=this.tbel();
                if(!tableel) return this;
                var datael=tableel.querySelector("tbody");
                if(!datael ) return this;
                if(!$$.isarray(datas)){datas=[datas];}
                for (var row in datas){
                    var rowdata=datas[row];
                    var rowel=document.createElement("tr");
                    datael.appendChild(rowel);
                    if(!$$.isarray(rowdata)){rowdata=[rowdata];}
                    for(var col in rowdata){
                        var tdel=document.createElement("td");
                        rowel.appendChild(tdel);
                        var tddata=rowdata[col];
                        tdel.innerHTML=tddata;
                    }
                }
            },
            read:function(){},
            clear:function(){
                var tableel=this.tbel();
                if(tableel){
                   let datael=tableel.querySelector("tbody");
                   datael&&(datael.innerHTML="");
                }
                return this;
            },
            append:function(){}, 
            settd:function(){},
            gettd:function(){},
            settr:function(){},
            gettr:function(){},
        },       
        
        tbtitle:{
            _tbel:tbel,
            tbel:function(){return this._tbel;},
            _setup:{
                field:"col",
                name:"col",
                type:"data",
                visable:true,
                editable:false,
                options:"",
            },
            getdef:function(eq){
                var fieldel=this.fieldel(eq);
                if(!fieldel){return {};}
                var attrs=fieldel.attributes;
                var rsdef={};
                attrs.forEach(function(attr){
                    rsdef[attr.split("-t")[0]]=fieldel.getAttribute(attr);
                });
                return rsdef;
            },
            fieldel:function(eq){
                var tableel=this.tbel();
                if(tableel){
                    return tableel.querySelector("thead>tr>th:nth-child("+eq+")");
                } else {
                    return null;
                }
            },
            setup:function(){return sm.setup.apply(this,arguments);},
            add:function(coldef){
                var tableel=this.tbel();
                if(!tableel) return this;
                var titleel=tableel.querySelector("thead>tr");
                if(!titleel ) return this;
                if(!$$.isobj(coldef)){
                    if($$.isarray(coldef)){
                        var t=this.setup();
                        var i=0;
                        var tidy={};
                        for(var k in t){
                            if(i<coldef.length) {
                                tidy[k]=coldef[i];
                            } else {
                                tidy[k]=t[k];
                            }
                            i++;
                        }
                        coldef=tidy;
                    } else {
                        coldef={field:coldef,name:coldef};
                    }
                }
                var finalcoldef={}
                $$.merge.apply(finalcoldef,[this.setup()]);
                $$.merge.apply(finalcoldef,[coldef]);
                var fieldel=document.createElement("td");
                for (var k in finalcoldef){
                    var v=finalcoldef[k];
                    fieldel.setAttribute(k+"-t",v);
                    if(k=="name"){
                        fieldel.innerHTML=v;
                    }
                }
                titleel.appendChild(fieldel);
                return this;
            },
            define:function(defs){
                var me=this;
                !$$.isarray(defs)&&(defs=[defs]);
                var i=1;
                defs.forEach(function(def){
                    var fieldel=me.fieldel(i);
                    if(fieldel){
                        if(!$$.isobj(def)){
                            if($$.isarray(def)){
                                var t=me.setup();
                                var ii=0;
                                var tidy={};
                                for(var k in t){
                                    if(ii<def.length) {
                                        tidy[k]=def[ii];
                                    } else {
                                        tidy[k]=t[k];
                                    }
                                    ii++;
                                }
                                def=tidy;
                            } else {
                                def={field:def,name:def};
                            }
                        }
                        for (var k in def){
                            var v=def[k];
                            fieldel.setAttribute(k+"-t",v);
                            if(k=="name"){
                                fieldel.innerHTML=v;
                            }
                        }
                    } else {
                        me.add(def);
                    }
                    i++;
                });
            },
            definefield:function(){},
            definetype:function(){},//key,data,flex
            definename:function(){},
            definevisable:function(){},
            definesortable:function(){},
            defineeditable:function(){},
            clear:function(){
                var tableel=this.tbel();
                if(tableel){
                   let titleel=tableel.querySelector("thead>tr");
                   titleel&&(titleel.innerHTML="");
                }
                return this;
            },
            remove:function(){},
        },
        clear:function(){
            this.tbdata.clear();
            this.tbtitle.clear();
            return this;
        },
        
        
        
        
        
        
    }).watchdom({
        "table@click":function(){console.log("you clicked table");},
        "th@click":function(){console.log("you clicked field")},
        "tr@click":function(){console.log("you clicked tr")},
        "td@click":function(){console.log("you clicked td")},
    });
});

</script>